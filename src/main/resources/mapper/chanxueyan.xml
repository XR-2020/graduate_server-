<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.graduate_sever.Dao.ChanXueYanMapper">
    <!--产学研实体映射-->
    <resultMap id="ChanXueYan" type="com.example.graduate_sever.model.ChanXueYan">
        <id column="id" jdbcType="INTEGER" property="id"/>
        <result column="status" jdbcType="INTEGER" property="status"/>
        <result column="finishtime" jdbcType="VARCHAR" property="finishtime"/>
        <result column="lianghua" jdbcType="VARCHAR" property="lianghua"/>
        <result column="wenhao" jdbcType="VARCHAR" property="wenhao"/>
        <result column="name" jdbcType="VARCHAR" property="name"/>
        <result column="partment" jdbcType="VARCHAR" property="partment"/>
        <result column="badge" jdbcType="INTEGER" property="badge"/>
        <result column="shenbao" property="shenbao"/>
        <result column="metails" property="metails"/>
    </resultMap>
    <resultMap id="MyShenBaoModel" type="com.example.graduate_sever.model.MyShenBaoModel">
        <result column="name" property="name"/>
        <result column="id" property="id"/>
        <result column="partment" property="partment"/>
        <result column="finishtime" property="finishtime"/>
    </resultMap>
    <!--参与人映射-->
    <resultMap id="ChanXueYan_people" type="com.example.graduate_sever.common.People">
        <result column="badeg" jdbcType="INTEGER" javaType="int" property="badge"/>
        <result column="tea_name" jdbcType="VARCHAR" javaType="string" property="name"/>
    </resultMap>
    <resultMap id="ChanXueYan_count" type="java.lang.Long"/>
    <resultMap id="ChanXueYanid" type="java.lang.Integer"/>
    <resultMap id="ChanXueYanMetails" type="com.example.graduate_sever.common.Metails">
        <result column="metails" property="metails"/>
    </resultMap>

    <!--教师下拉列表映射-->
    <resultMap id="Teacher" type="com.example.graduate_sever.model.Teacher">
        <result column="badeg" jdbcType="INTEGER" javaType="int" property="badge"/>
        <result column="tea_name" jdbcType="VARCHAR" javaType="string" property="name"/>
        <result column="password" jdbcType="VARCHAR" javaType="string" property="password"/>
        <result column="role" jdbcType="INTEGER" javaType="int" property="role"/>
    </resultMap>
    <!--查询产学研所有成果-->
    <!--application.yml 中通过 type-aliases-package 指定了实体类的为了，因此-->
    <select id="getAll" resultMap="ChanXueYan,ChanXueYan_count">
        <bind name="beginIndex" value="(pageIndex-1)*pageSize"></bind>
        select chanxueyan.* from chanxueyan where status=1 limit #{beginIndex,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER};select count(*) ChanXueYan_count from chanxueyan where status=1;
    </select>
    <!--删除一个产学研成果-->
    <delete id="deleteOneChanXueYan">
        delete from chanxueyan where chanxueyan.id=#{id}
    </delete>
    <!--查询指定产学研成果人员信息-->
    <select id="getChanXueYanDetail" parameterType="java.lang.Integer" resultMap="ChanXueYan_people">
        select teacher.tea_name,teacher.badeg from  participation,teacher where participation.badge=teacher.badeg and participation.ach_id=#{id} and participation.type=1
    </select>
    <!--产学研成果全局模糊查询-->
    <select id="getSearchChanXueYan" resultMap="ChanXueYan,ChanXueYan_count">
        <bind name="beginIndex" value="(pageIndex-1)*pageSize"></bind>
        select c.* from chanxueyan c,teacher t,participation p where status=1 and p.badge=t.badeg and p.ach_id=c.id and CONCAT(c.id,t.tea_name,c.partment,c.name,c.wenhao,c.lianghua,c.finishtime,c.status,p.badge) LIKE CONCAT('%',#{key},'%') limit #{beginIndex,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER};
        select count(*) ChanXueYan_count from chanxueyan c,teacher t,participation p where status=1 and p.badge=t.badeg and p.ach_id=c.id and CONCAT(c.id,t.tea_name,c.partment,c.name,c.wenhao,c.lianghua,c.finishtime,c.status,p.badge) LIKE CONCAT('%',#{key},'%');
    </select>
    
    <insert id="insertChanXueYan" parameterType="com.example.graduate_sever.entity.ChanXueYanEntity" useGeneratedKeys="true" keyProperty="id">
        INSERT IGNORE INTO chanxueyan (`status`, `finishtime`, `lianghua`, `wenhao`, `name`,`partment`,`badge`) VALUES (#{status,jdbcType=INTEGER},#{finishtime,jdbcType=VARCHAR},#{lianghua,jdbcType=VARCHAR},#{wenhao,jdbcType=VARCHAR},#{name,jdbcType=VARCHAR},#{partment,jdbcType=VARCHAR},#{badge,jdbcType=INTEGER})
    </insert>

    <insert id="shenBaoChanXueYan" parameterType="com.example.graduate_sever.entity.ChanXueYanEntity" useGeneratedKeys="true" keyProperty="id">
        INSERT IGNORE INTO chanxueyan (`status`, `finishtime`, `lianghua`, `wenhao`, `name`,`partment`,`shenbao`,`metails`) VALUES (#{status,jdbcType=INTEGER},#{finishtime,jdbcType=VARCHAR},#{lianghua,jdbcType=VARCHAR},#{wenhao,jdbcType=VARCHAR},#{name,jdbcType=VARCHAR},#{partment,jdbcType=VARCHAR},#{badge,jdbcType=INTEGER},#{metails,jdbcType=BINARY})
    </insert>

    <insert id="insertChanXueYanParticipation" parameterType="com.example.graduate_sever.entity.ParticipationEntity" useGeneratedKeys="true">
        INSERT IGNORE INTO participation(`badge`, `ach_id`, `type`) VALUES (#{badge,jdbcType=INTEGER},#{ach_id,jdbcType=INTEGER},#{type,jdbcType=INTEGER})
    </insert>

    <select id="getTeacherList" resultMap="Teacher">
        SELECT * from teacher
    </select>

    <select id="ChanXueYanmetails" parameterType="java.lang.Integer" resultMap="ChanXueYanMetails">
        SELECT metails FROM `chanxueyan` where id=#{id}
    </select>
    <select id="selectChanXueYan" parameterType="java.lang.String" resultMap="ChanXueYan">
        select * from `chanxueyan` where status=1 and finishtime between #{date1} and #{date2}
    </select>

    <select id="waitingPageTotal" parameterType="java.lang.String" resultMap="ChanXueYan_count">
      select count(*) ChanXueYan_count from ${type} where status=0;
    </select>

    <select id="waitingChanXueYan" resultMap="ChanXueYan">
        <bind name="beginIndex" value="(pageIndex-1)*pageSize"></bind>
        select * from `chanxueyan` where status=0 limit #{beginIndex,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
    </select>
    
    <update id="passChanXueYan" parameterType="java.lang.Integer">
        update `chanxueyan` set `status`=#{ispass} where id=#{id}
    </update>

    <select id="getDisData" resultMap="MyShenBaoModel">
        <bind name="beginIndex" value="(pageIndex-1)*pageSize"></bind>
        select c.name,c.id,c.partment,c.finishtime from ${tablename} c,participation p where status=-1 and p.ach_id=c.id and  c.shenbao=p.badge and c.shenbao=#{badge} and p.type=#{type} limit #{beginIndex,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
    </select>
    <select id="getPageTotal" resultMap="ChanXueYan_count">
        select count(*) from ${tablename} c,participation p where status=-1 and c.shenbao=p.badge and p.ach_id=c.id and c.shenbao=#{badge} and p.type=#{type}
    </select>

    <select id="getDetail" parameterType="java.lang.Integer" resultMap="ChanXueYan_people">
        select teacher.tea_name,teacher.badeg from  participation,teacher where participation.badge=teacher.badeg and participation.ach_id=#{id} and participation.type=#{type}
    </select>

    <select id="getHadPassData" resultMap="MyShenBaoModel">
        <bind name="beginIndex" value="(pageIndex-1)*pageSize"></bind>
        select c.name,c.id,c.partment,c.finishtime from ${tablename} c,participation p where status=1 and p.ach_id=c.id and c.shenbao=p.badge and c.shenbao=#{badge} and p.type=#{type} limit #{beginIndex,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
    </select>
    <select id="getHadPassPageTotal" resultMap="ChanXueYan_count">
        select count(*) from ${tablename} c,participation p where status=1 and c.shenbao=p.badge and p.ach_id=c.id and  c.shenbao=#{badge} and p.type=#{type}
    </select>

    <select id="getDaiShenHeData" resultMap="MyShenBaoModel">
        <bind name="beginIndex" value="(pageIndex-1)*pageSize"></bind>
        select c.name,c.id,c.partment,c.finishtime from ${tablename} c,participation p where status=0 and p.ach_id=c.id and c.shenbao=p.badge and c.shenbao=#{badge} and p.type=#{type} limit #{beginIndex,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
    </select>
    <select id="getDaiShenHePageTotal" resultMap="ChanXueYan_count">
        select count(*) from ${tablename} c,participation p where status=0 and c.shenbao=p.badge and p.ach_id=c.id and c.shenbao=#{badge} and p.type=#{type}
    </select>

    <delete id="deleteMyShenBao">
        delete from ${tablename} where id=#{id}
    </delete>
    <delete id="deleteDaiShenHePartipation">
        delete from participation where ach_id=#{id} and type=#{type}
    </delete>
</mapper>

