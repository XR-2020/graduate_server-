<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.graduate_sever.Dao.RongYuChengHaoMapper">
    <!--实体映射-->
    <resultMap id="RongYu" type="com.example.graduate_sever.model.Honor">
        <id column="id" jdbcType="INTEGER" property="id"/>
        <result column="status" jdbcType="INTEGER" property="status"/>
        <result column="finishtime" jdbcType="VARCHAR" property="finishtime"/>
        <result column="name" jdbcType="VARCHAR" property="name"/>
        <result column="badge" jdbcType="INTEGER" property="badge"/>
        <result column="shenbao" property="shenbao"/>
        <result column="metails" property="metails"/>
        <result column="level" jdbcType="VARCHAR" property="level"/>
    </resultMap>
    <!--参与人映射-->
    <resultMap id="RongYu_people" type="com.example.graduate_sever.common.People">
        <result column="badeg" jdbcType="INTEGER" javaType="int" property="badge"/>
        <result column="tea_name" jdbcType="VARCHAR" javaType="string" property="name"/>
    </resultMap>
    <resultMap id="RongYucount" type="java.lang.Long"/>
    <resultMap id="RongYuMetails" type="com.example.graduate_sever.common.Metails">
        <result column="metails" property="metails"></result>
    </resultMap>
    <!--查询教研项目所有成果-->
    <!--application.yml 中通过 type-aliases-package 指定了实体类的为了，因此-->
    <select id="getAllRongYu" resultMap="RongYu,RongYucount">
        <bind name="beginIndex" value="(pageIndex-1)*pageSize"></bind>
        select honor.* from honor where status=1 limit #{beginIndex,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER};select count(*) RongYucount from honor where status=1;
    </select>
    <!--删除一个教研项目-->
    <delete id="deleteOneRongYu">
        delete * from honor where honor.id=#{id}
    </delete>
<!--    &lt;!&ndash;查询指定教研项目成果人员信息&ndash;&gt;-->
<!--    <select id="getRongYuDetail" parameterType="java.lang.Integer" resultMap="ZhuZuo_people">-->
<!--        select teacher.tea_name,teacher.badeg from participation,teacher where participation.badge=teacher.badeg and participation.ach_id=#{id} and participation.type=9-->
<!--    </select>-->
<!--    &lt;!&ndash;教研项目成果全局模糊查询&ndash;&gt;-->
    <select id="getSearchRongYu" resultMap="RongYu,RongYucount">
        <bind name="beginIndex" value="(pageIndex-1)*pageSize"></bind>
        select c.* from honor c,teacher t,participation p where status=1 and p.badge=t.badeg and p.ach_id=c.id and CONCAT(c.id,t.tea_name,c.partment,c.name,c.finishtime,c.status,p.badge,c.level) LIKE CONCAT('%',#{key},'%') limit #{beginIndex,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER};
        select count(*) RongYucount from honor c,teacher t,participation p where status=1 and p.badge=t.badeg and p.ach_id=c.id and CONCAT(c.id,t.tea_name,c.partment,c.name,c.finishtime,c.status,p.badge,c.level) LIKE CONCAT('%',#{key},'%');
    </select>

    <insert id="insertRongYuChengHao" parameterType="com.example.graduate_sever.entity.HonorEntity" useGeneratedKeys="true" keyProperty="id">
        INSERT IGNORE INTO honor(`status`, `name`, `finishtime`, `level`,`partment`,`badge`) VALUES (#{status,jdbcType=INTEGER},#{name,jdbcType=VARCHAR},#{finishtime,jdbcType=VARCHAR},#{level,jdbcType=VARCHAR},#{partment,jdbcType=VARCHAR},#{badge,jdbcType=INTEGER})
    </insert>
    <insert id="shenBaoRongYuChengHao" parameterType="com.example.graduate_sever.entity.HonorEntity" useGeneratedKeys="true" keyProperty="id">
        INSERT IGNORE INTO honor(`status`, `name`, `finishtime`, `level`,`partment`,`shenbao`,`metails`) VALUES (#{status,jdbcType=INTEGER},#{name,jdbcType=VARCHAR},#{finishtime,jdbcType=VARCHAR},#{level,jdbcType=VARCHAR},#{partment,jdbcType=VARCHAR},#{badge,jdbcType=INTEGER})
    </insert>

    <insert id="insertRongYuChengHaoParticipation" parameterType="com.example.graduate_sever.entity.ParticipationEntity" useGeneratedKeys="true">
        INSERT IGNORE INTO participation(`badge`, `ach_id`, `type`) VALUES (#{badge,jdbcType=INTEGER},#{ach_id,jdbcType=INTEGER},#{type,jdbcType=INTEGER})
    </insert>

    <select id="RongYuMetails" parameterType="java.lang.Integer" resultMap="RongYuMetails">
        SELECT metails FROM `honor` where id=#{id}
    </select>

    <select id="selectRongYuChengHao" parameterType="java.lang.String" resultMap="RongYu">
        select * from `honor` where status=1 and finishtime between #{date1} and #{date2}
    </select>

    <select id="waitingrongyuchenghao" resultMap="RongYu">
        <bind name="beginIndex" value="(pageIndex-1)*pageSize"></bind>
        select * from `honor` where status=0 limit #{beginIndex,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
    </select>
</mapper>

