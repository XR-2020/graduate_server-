<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.graduate_sever.Dao.HengXiangKeYanMapper">
    <!--实体映射-->
    <resultMap id="HengXiangKeYan" type="com.example.graduate_sever.model.HengXiangKeYanXiangMu">
        <id column="id" jdbcType="INTEGER" property="id"/>
        <result column="status" jdbcType="INTEGER" property="status"/>
        <result column="finishtime" jdbcType="VARCHAR" property="finishtime"/>
        <result column="name" jdbcType="VARCHAR" property="name"/>
        <result column="partment" jdbcType="VARCHAR" property="partment"/>
        <result column="badge" jdbcType="INTEGER" property="badge"/>
        <result column="tea_name" jdbcType="VARCHAR" property="tea_name"/>
    </resultMap>
    <!--参与人映射-->
    <resultMap id="HengXiangKeYan_people" type="com.example.graduate_sever.common.People">
        <result column="badeg" jdbcType="INTEGER" javaType="int" property="badge"/>
        <result column="tea_name" jdbcType="VARCHAR" javaType="string" property="name"/>
    </resultMap>
    <resultMap id="count2" type="java.lang.Long"/>
    <!--查询教研项目所有成果-->
    <!--application.yml 中通过 type-aliases-package 指定了实体类的为了，因此-->
    <select id="getAllHengXiangKeYan" resultMap="HengXiangKeYan,count2">
        <bind name="beginIndex" value="(pageIndex-1)*pageSize"></bind>
        select hengxiangkeyanxiangmu.*,teacher.tea_name from hengxiangkeyanxiangmu,teacher where status=1 and hengxiangkeyanxiangmu.badge=teacher.badeg limit #{beginIndex,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER};select found_rows() count2;
    </select>
    <!--删除一个教研项目-->
    <delete id="deleteOneHengXiangKeYan">
        delete * from hengxiangkeyanxiangmu where hengxiangkeyanxiangmu.id=#{id}
    </delete>
    <!--查询指定教研项目成果人员信息-->
    <select id="getHengXiangKeYanDetail" parameterType="java.lang.Integer" resultMap="HengXiangKeYan_people">
        select teacher.tea_name,teacher.badeg from participation,teacher where participation.badge=teacher.badeg and participation.ach_id=#{id} and participation.type=7
    </select>
    <!--教研项目成果全局模糊查询-->
    <select id="getSearchHengXiangKeYan" resultMap="HengXiangKeYan,count2">
        <bind name="beginIndex" value="(pageIndex-1)*pageSize"></bind>
        select c.*,t.tea_name from hengxiangkeyanxiangmu c,teacher t
        where status=1 and c.badge=t.badeg and CONCAT(c.id,t.tea_name,c.badge,c.partment,c.name,c.finishtime,c.status) LIKE CONCAT('%',#{key},'%') limit #{beginIndex,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER};select found_rows() count2;
    </select>
<!--&lt;!&ndash;    新增一个横向科研项目&ndash;&gt;-->
<!--    <insert id="insertHengXiangKeYan" parameterType="com.example.graduate_sever.entity.HeBingEntity" useGeneratedKeys="true">-->
<!--        INSERT INTO hengxiangkeyanxiangmu (`status`, `finishtime`, `lianghua`, `wenhao`, `name`, `partment`, `badge`) VALUES (#{status,jdbcType=INTEGER},#{finishtime,jdbcType=VARCHAR},#{lianghua,jdbcType=VARCHAR},#{wenhao,jdbcType=VARCHAR},#{name,jdbcType=VARCHAR},#{partment,jdbcType=VARCHAR},#{badge,jdbcType=INTEGER})-->
<!--    </insert>-->
</mapper>

